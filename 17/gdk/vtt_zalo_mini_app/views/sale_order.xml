<odoo>
    <!-- Sale order views -->
    <data>

        <record id="zalo_sale_order_form_inherit" model="ir.ui.view">
            <field name="name">Zalo - Inherit Sale order form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <!--      <field name="mode">form</field>-->
            <field name="arch" type="xml">
                <field name="state" position="attributes">
                    <attribute name="invisible">is_online_order</attribute>
                </field>
                <field name="state" position="before">
                    <field name="online_order_state" widget="statusbar"
                           statusbar_visible="draft,processing,delivering,done,cancel" invisible="not is_online_order"/>
                </field>

                <field name="name" position="before">
                    <field name="is_online_order" invisible="1"/>
                    <field name="zalo_payment_state" invisible="1"/>
                    <!-- ###GHN-OK <field name="ghn_order_code" invisible="1"/> -->
                    <field name="online_order_state" invisible="1"/>

                    <div class="vtt_zalo_customer" invisible="not is_online_order">
                        <span class="o_tag position-relative d-inline-flex align-items-center user-select-none mw-100 o_badge badge rounded-pill lh-1 o_tag_color_2"
                              tabindex="-1" data-color="2" title="Zalo customer">
                            <div class="o_tag_badge_text text-truncate">Đơn hàng Online</div>
                        </span>

                        <span class="o_tag position-relative d-inline-flex align-items-center user-select-none mw-100 o_badge badge rounded-pill lh-1 o_tag_color_1"
                              tabindex="-1" data-color="2" title="Zalo customer" invisible="zalo_payment_state=='paid'">
                            <div class="o_tag_badge_text text-truncate">Chưa thanh toán</div>
                        </span>
                        <span class="o_tag position-relative d-inline-flex align-items-center user-select-none mw-100 o_badge badge rounded-pill lh-1 o_tag_color_7"
                              tabindex="-1" data-color="2" title="Zalo customer"
                              invisible="zalo_payment_state=='unpaid'">
                            <div class="o_tag_badge_text text-truncate">Đã thanh toán</div>
                        </span>
                        <br/>
                    </div>
                </field>

<!--                <field name="redeem_points" position="after">-->
<!--                    <field name="your_field"/>-->
<!--                </field>-->
                <field name='partner_id' position="attributes">
                    <attribute name="domain">[('type', '!=', 'delivery')]</attribute>
                </field>

            <field name="payment_term_id" position="after">
                <field name="cancel_reason_for_customer" invisible="not is_online_order" string="Lý do hủy đơn" readonly="1"/>
                <field name="shipper_name" invisible="not is_online_order" string="Shipper" placeholder="Tên shipper"/>
                <field name="shipper_phone" invisible="not is_online_order" string="Shipper sđt" placeholder="SĐT shipper"/>
                <field name="actual_shipping_fee" invisible="not is_online_order" string="Phí ship thực tế"/>
            </field>
          <field name="partner_id" position="after">
              <field name="delivery_address_id" invisible="not is_online_order" context="{'default_parent_id': partner_id, 'default_type': 'delivery'}"/>
              <field name="full_text_delivery_address" invisible="not is_online_order" readonly="1"/>
              <field name="partner_shipping_id" invisible="1"/>
              <field name="payment_method" invisible="not is_online_order" string="Phương thức thanh toán"/>
<!--              <field name="shipping_method" invisible="not is_online_order"/>-->

                    <!--              <field name="is_online_order"/>-->
                    <field name="customer_confirmed" invisible="not is_online_order"/>
                    <field name="customer_note" invisible="not is_online_order"/>
                    <field name="redeem_points" readonly="1" invisible="not is_online_order"/>
                    <!-- <field name="custom_total"/> -->
                </field>

                <!-- *** Button ***-->
                <button name="action_quotation_send" position="attributes">
                    <attribute name="invisible">is_online_order</attribute>
                </button>

                <button name="action_preview_sale_order" position="attributes">
                    <attribute name="invisible">is_online_order</attribute>
                </button>

          <button name="action_confirm" position="before">
              <button name="action_done" type="object" string="Hoàn thành" class="btn btn-primary" invisible="online_order_state in ['done', 'cancel']"/>
          </button>

          <button name="action_preview_sale_order" position="after">
              <!-- <button name="apply_shipping_method" string="Áp dụng phí ship" type="object" class="btn-secondary" invisible="online_order_state not in ['draft']"/> -->
<!--              <button name="reload_order" string="Load order" type="object" class="btn-secondary"/>-->
            <button name="action_abc" string="Abc" type="object" class="btn-secondary" />

              <!-- <button name="action_send_zns_payment" string="Gửi ZNS" type="object" class="btn-secondary" invisible="online_order_state in ['draft', 'cancel'] or not is_online_order"/> -->
              <button name="action_paid" type="object" string="KH đã thanh toán" class="btn btn-secondary" invisible="zalo_payment_state == 'paid' or not is_online_order"/>
<!--              <button name="action_processing" type="object" string="Đang xử lý" class="btn btn-secondary" invisible="online_order_state in ['processing', 'done', 'cancel']"/>-->
              <button name="action_delivering" type="object" string="Đang giao hàng" class="btn btn-secondary" invisible="online_order_state in ['delivering', 'done', 'cancel'] or not is_online_order"/>
              <!-- ###GHN-OK <button name="check_carrier_delivery_status" type="object" string="Shipping fee" class="btn btn-secondary" invisible="not ghn_order_code"/> -->
          </button>

                <button name="action_open_discount_wizard" position="before">
                    <button name="apply_loyalty_reward"
                            type="object"
                            string="Áp dụng KM Loyalty"
                            help="Áp dụng KM theo hạng thẻ thành viên"
                            invisible="not partner_id"
                            class="btn btn-secondary"/>
                </button>
            </field>
        </record>


        <!-- Inherit Sale Order tree view -->
        <!--      <record id="zalo_sale_order_tree_inherit" model="ir.ui.view">-->
        <!--          <field name="name">Zalo - Inherit Sale order tree</field>-->
        <!--          <field name="model">sale.order</field>-->
        <!--          <field name="inherit_id" ref="sale.sale_order_tree"/>-->
        <!--&lt;!&ndash;          <field name="mode">tree</field>&ndash;&gt;-->
        <!--          <field name="arch" type="xml">-->
        <!--              <field name="user_id" position="before">-->
        <!--                  <field name="source_id"/>-->
        <!--                  <field name="payment_method"/>-->
        <!--&lt;!&ndash;                  <field name="state_for_employee"&ndash;&gt;-->
        <!--&lt;!&ndash;                    decoration-success="state == 'sale'"&ndash;&gt;-->
        <!--&lt;!&ndash;                    decoration-info="state == 'draft'"&ndash;&gt;-->
        <!--&lt;!&ndash;                    decoration-primary="state == 'sent'"&ndash;&gt;-->
        <!--&lt;!&ndash;                    widget="badge"/>&ndash;&gt;-->
        <!--              </field>-->
        <!--          </field>-->
        <!--      </record>-->

      <!-- ZALO Sale Order Tree -->
      <record id="vtt_zalo_sale_order_tree" model="ir.ui.view">
        <field name="name">vtt.zalo.sale.order.tree</field>
        <field name="model">sale.order</field>
        <field name="arch" type="xml">
            <tree string="Đơn hàng online">
<!--                <field name="sequence" widget="handle"/>-->
<!--                <field name="state" invisible="1"/>-->
                <field name="name" decoration-bf="1"/>
                <field name="create_date"/>
                <field name="partner_id"/>
                <field name="full_text_delivery_address"/>
                <field name="payment_method" string="Phương thức thanh toán"/>
<!--                <field name="shipping_method"/>-->
                <field name="zalo_payment_state"
                       decoration-bf="zalo_payment_state =='paid'"
                       decoration-success="zalo_payment_state == 'paid'"
                       decoration-primary="zalo_payment_state == 'unpaid'"
                       string="Trạng thái thanh toán"
                />
                <!-- <field name="team_id"/> -->
                <field name="activity_ids" widget="list_activity"/>
                <field name="amount_total"
                       widget="monetary"
                       decoration-bf="1"
                       />
                                  <field name="online_order_state"
                                         string="Trạng thái"
                    decoration-success="online_order_state == 'done'"
                    decoration-info="online_order_state == 'draft'"
                    decoration-primary="online_order_state == 'proccessing'"
                    widget="badge"/>
                <!--                <field name="website_id" groups="website.group_multi_website"/>-->
            </tree>
        </field>
    </record>

    <!-- _________________ Zalo Sale Order Search _______________________ -->
    <record id="view_vtt_zalo_sale_order_search" model="ir.ui.view">
        <field name="name">vtt.zalo.sale.order.search</field>
        <field name="model">sale.order</field>
        <field name="arch" type="xml">
            <search>
                <field name="name" string="Order"
                    filter_domain="['|', '|', ('name', 'ilike', self), ('client_order_ref', 'ilike', self), ('partner_id', 'child_of', self)]"/>
                <field name="partner_id" operator="child_of"/>
                <field name="user_id"/>
                <field name="team_id" string="Sales Team"/>
                <field name="order_line" string="Product" filter_domain="[('order_line.product_id', 'ilike', self)]"/>
                <field name="analytic_account_id" groups="analytic.group_analytic_accounting"/>
                <!-- We only allow to search on the following sale order line fields (product, name) because the other fields, such as price, quantity, ...
                    will not be searched as often, and if they need to be searched it's usually in the context of products
                    and then they can be searched from the page listing the sale order lines related to a product (from the product itself).
                -->
                <!-- <filter string="My Orders" domain="[('user_id', '=', uid)]" name="my_sale_orders_filter"/> -->
                <filter invisible="1" string="Late Activities" name="activities_overdue"
                    domain="[('my_activity_date_deadline', '&lt;', context_today().strftime('%Y-%m-%d'))]"
                    help="Show all records which has next action date is before today"/>
                <filter invisible="1" string="Today Activities" name="activities_today"
                    domain="[('my_activity_date_deadline', '=', context_today().strftime('%Y-%m-%d'))]"/>
                <filter invisible="1" string="Future Activities" name="activities_upcoming_all"
                    domain="[('my_activity_date_deadline', '&gt;', context_today().strftime('%Y-%m-%d'))]"/>
                <group expand="0" string="Group By">
                    <!-- <filter string="Salesperson" name="salesperson" domain="[]" context="{'group_by': 'user_id'}"/> -->
                    <filter name="customer" string="Customer" domain="[]" context="{'group_by': 'partner_id'}"/>
                    <filter string="Ngày đặt hàng" name="order_month" domain="[]" context="{'group_by': 'date_order'}"/>
                </group>
                 <filter string="Khách hàng đã xác nhận" name="customer_confirmed" domain="[('customer_confirmed', '=', True)]"/>
<!--                <filter string="Confirmed Customers" name="customer_confirmed" domain="[('customer_confirmed', '=', True)]" context="{'default_customer_confirmed': True}"/>                -->
            </search>
        </field>
    </record>

    <!-- _________________ Zalo Sale Order Tree Action _______________________ -->
    <record id="vtt_zalo_sale_order_tree_action" model="ir.actions.act_window">
        <field name="name">Đơn hàng online</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,form,activity</field>
        <field name="view_id" ref="vtt_zalo_sale_order_tree"/>        
        <field name="search_view_id" ref="view_vtt_zalo_sale_order_search"/>
       <field name="context">{'default_is_online_order': true, 'search_default_customer_confirmed': 1}</field>
<!--        <field name="context">{'default_is_online_order': true}</field>-->
<!--        <field name="domain">[('customer_confirmed', '=', True)]</field>-->

        </record>

    <!-- _________________ Sale Order [Quotation tree view] _______________________ -->
    <!-- hide sale order from zalo if state = draft and customer_confirmed = False -->      
    <!-- <record id="sale.action_quotations_with_onboarding" model="ir.actions.act_window">
        <field name="domain">[('is_online_order', '=', False)]</field>
        <field name="context">{'default_is_online_order': False}</field>
    </record> -->
  </data>
</odoo>