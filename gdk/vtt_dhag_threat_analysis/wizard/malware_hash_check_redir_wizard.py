# -*- coding: utf-8 -*-

from odoo import models, fields, api, _


class MalwareHashCheckRedirectWizard(models.TransientModel):
    _name = 'malware.hash.check.redirect.wizard'
    _description = 'Malware Creating Checking Hash Wizard'

    def _get_default_malware_same_hash(self):
        context = self._context or {}
        return self.env['threat.malware'].browse(context.get('same_hash_id', False))

    def _get_default_malware_new_copy(self):
        context = self._context or {}
        return self.env['threat.malware'].browse(context.get('new_copy_id', False))

    malware_same_hash_id = fields.Many2one('threat.malware', 'Malware With Same Hash', default=_get_default_malware_same_hash)
    malware_new_copy_id = fields.Many2one('threat.malware', 'Malware New Copy', default=_get_default_malware_new_copy)

    def button_redir(self):
        self.malware_same_hash_id.submit_count = self.malware_same_hash_id.submit_count + 1
        self.malware_new_copy_id.unlink()
        if self.malware_same_hash_id:
            return {
                'type': 'ir.actions.act_window',
                'name': _('Malware'),
                'res_model': 'threat.malware',
                'target': 'main',
                'view_mode': 'form',
                'context': {'form_view_initial_mode': 'edit'},
                'res_id': self.malware_same_hash_id.id
                # 'views': [[False, 'form']],
            }