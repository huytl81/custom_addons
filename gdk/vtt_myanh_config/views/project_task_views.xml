<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <!--Task views-->
    <data>
        <!--Kanban view add Task Reason-->
        <record id="vtt_view_kanban_project_task_reason" model="ir.ui.view">
            <field name="name">Task Kanban add Reason</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_kanban"/>
            <field name="arch" type="xml">
                <xpath expr="//div[hasclass('o_kanban_record_body')]/field[@name='tag_ids']" position="after">
                    <field name="reason_type_id" options="{'color_field': 'color'}" invisible="state not in ('02_changes_requested')"/>
                </xpath>
            </field>
        </record>

        <!--Form view add Task Reason-->
        <record id="vtt_view_form_project_task_reason" model="ir.ui.view">
            <field name="name">Task Form add Reason</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_form2"/>
            <field name="arch" type="xml">
                <field name="tag_ids" position="after">
                    <field name="reason_type_id" options="{'color_field': 'color'}" invisible="state not in ('02_changes_requested')"/>
                    <field name="reason_detail_need" invisible="1"/>
                    <field name="reason" invisible="state not in ('02_changes_requested') or reason_detail_need == False"/>
                </field>

                <xpath expr="//notebook/page[@name='sub_tasks_page']/field[@name='child_ids']" position="attributes">
                    <attribute name="context">{
                        'default_project_id': project_id,
                        'default_display_in_project': False,
                        'default_user_ids': user_ids,
                        'default_parent_id': id,
                        'default_stage_id': stage_id,
                        'default_partner_id': partner_id,
                        'default_milestone_id': allow_milestones and milestone_id
                        }</attribute>
                </xpath>
            </field>
        </record>

        <!--Search view add Task Reason-->
        <record id="vtt_view_search_project_task_reason" model="ir.ui.view">
            <field name="name">Task Filter add Reason</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_search_form_base"/>
            <field name="arch" type="xml">
                <filter name="last_stage_update" position="after">
                    <filter string="Reason" name="groupby_reason_type" context="{'group_by': 'reason_type_id'}"/>
                </filter>
            </field>
        </record>

        <!--List view add Duplicate-->
        <record id="vtt_view_tree_project_task_dup_project" model="ir.ui.view">
            <field name="name">Task List add Duplicate</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.project_task_view_tree_main_base"/>
            <field name="arch" type="xml">

                <tree position="inside">
                    <header>
                        <button name="action_dup_2_project" type="object" string="Duplicate 2 Projects" groups="project.group_project_manager"/>
                    </header>
                </tree>
            </field>
        </record>

        <!--Hierarchy List view-->
        <record id="vtt_view_tree_project_task_hierarchy" model="ir.ui.view">
            <field name="name">Project Task Hierarchy List</field>
            <field name="model">project.task</field>
            <field name="mode">primary</field>
            <field name="priority" eval="1000"/>
            <field name="arch" type="xml">
                <tree string="Tasks" sample="1" default_order="hierarchy_sequence, hierarchy_level, date_deadline asc, id desc" js_class="hierarchy_tree_view">
                    <field name="sequence" readonly="1" column_invisible="True"/>
                    <field name="parent_id" column_invisible="True"/>
                    <field name="hierarchy_level" column_invisible="True"/>
                    <field name="hierarchy_sequence" column_invisible="True"/>
                    <field name="allow_milestones" column_invisible="True"/>
                    <field name="subtask_count" column_invisible="True"/>
                    <field name="closed_subtask_count" column_invisible="True"/>
                    <field name="id" optional="hide"/>
                    <field name="priority" widget="priority" nolabel="1"/>
                    <field name="state" widget="project_task_state_selection" nolabel="1" options="{'is_toggle_mode': false}"/>
                    <field name="name" string="Title" widget="name_with_subtask_count"/>
                    <field name="project_id" widget="project" optional="show" options="{'no_open': 1}" readonly="1" column_invisible="context.get('default_project_id')"/>
                    <field name="milestone_id" invisible="not allow_milestones" context="{'default_project_id': project_id}" groups="project.group_project_milestone" optional="hide"/>
                    <field name="partner_id" optional="hide" widget="res_partner_many2one" invisible="not project_id" options="{'no_open': True}"/>
                    <field name="user_ids" optional="show" widget="many2many_avatar_user"/>
                    <field name="company_id" groups="base.group_multi_company" optional="show" column_invisible="context.get('default_project_id')"/>
                    <field name="company_id" column_invisible="True"/>
                    <field name="date_deadline" optional="hide" widget="remaining_days" invisible="state in ['1_done', '1_canceled']"/>
                    <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}" optional="show" context="{'project_id': project_id}"/>
                    <field name="date_last_stage_update" optional="hide"/>
                    <field name="stage_id" column_invisible="context.get('set_visible', False)" optional="show"/>
                </tree>
            </field>
        </record>

        <!--<record id="vtt_view_tree_project_task_all_task_hierarchy" model="ir.ui.view">
            <field name="name">All Tasks List Hierarchy</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.open_view_all_tasks_list_view"/>
            <field name="arch" type="xml">

                <tree position="attributes">
                    <attribute name="js_class">hierarchy_tree_view</attribute>
                    <attribute name="default_order">hierarchy_sequence</attribute>
                </tree>

                <field name="sequence" position="after">
                    <field name="hierarchy_sequence" column_invisible="1"/>
                    <field name="hierarchy_level" column_invisible="1"/>
                </field>
            </field>
        </record>-->

        <record id="vtt_view_tree_project_task_project_task_hierarchy" model="ir.ui.view">
            <field name="name">Project Task List Hierarchy</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_tree2"/>
            <field name="arch" type="xml">

                <tree position="attributes">
                    <attribute name="js_class">hierarchy_tree_view</attribute>
                    <attribute name="default_order">hierarchy_sequence</attribute>
                </tree>

                <field name="sequence" position="after">
                    <field name="hierarchy_sequence" column_invisible="1"/>
                    <field name="hierarchy_level" column_invisible="1"/>
                </field>
            </field>
        </record>
    </data>

    <!--Actions-->
    <data>
        <!--Action Tasks Hierarchy-->
        <record id="vtt_act_window_project_task_hierarchy" model="ir.actions.act_window">
            <field name="name">Tasks General</field>
            <field name="res_model">project.task</field>
            <field name="view_mode">tree,form</field>
            <!--<field name="domain">[('picking_id.picking_type_id.code', '=', 'outgoing')]</field>-->
            <field name="view_id" ref="vtt_myanh_config.vtt_view_tree_project_task_hierarchy"/>
            <field name="context">{}</field>
        </record>
    </data>
</odoo>